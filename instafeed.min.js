// Generated by CoffeeScript 1.3.3
(function(){var e,t;e=function(){function e(e){var t,n;this.options={target:"instafeed",get:"popular",resolution:"thumbnail",links:!0,limit:15};if(typeof e=="object")for(t in e)n=e[t],this.options[t]=n;this.unique=this._genKey()}return e.prototype.run=function(){var t,n,r;if(typeof this.options.clientId!="string"&&typeof this.options.accessToken!="string")throw new Error("Missing clientId or accessToken.");if(typeof this.options.accessToken!="string"&&typeof this.options.clientId!="string")throw new Error("Missing clientId or accessToken.");return this.options.before!=null&&typeof this.options.before=="function"&&this.options.before.call(this),typeof document!="undefined"&&document!==null&&(r=document.createElement("script"),r.id="instafeed-fetcher",r.src=this._buildUrl(),t=document.getElementsByTagName("head"),t[0].appendChild(r),n="instafeedCache"+this.unique,window[n]=new e(this.options),window[n].unique=this.unique),this.options.after!=null&&typeof this.options.after=="function"&&this.options.after.call(this),!0},e.prototype.parse=function(e){var t,n,r,i,s,o,u,a,f;if(typeof e!="object")throw new Error("Invalid JSON response");if(e.meta.code!==200)throw new Error("Problem parsing response: "+e.meta.error_message);if(e.data.length===0)throw new Error("No images were returned from Instagram");this.options.success!=null&&typeof this.options.success=="function"&&this.options.success.call(this,e);if(typeof document!="undefined"&&document!==null){n=document.createDocumentFragment(),s=e.data,s.length>this.options.limit&&(s=s.slice(0,this.options.limit+1||9e9));for(a=0,f=s.length;a<f;a++)i=s[a],o=document.createElement("img"),o.src=i.images[this.options.resolution].url,this.options.links===!0?(t=document.createElement("a"),t.href=i.link,t.appendChild(o),n.appendChild(t)):n.appendChild(o);document.getElementById(this.options.target).appendChild(n),r=document.getElementsByTagName("head")[0],r.removeChild(document.getElementById("instafeed-fetcher")),u="instafeedCache"+this.unique,delete window[u]}return!0},e.prototype._buildUrl=function(){var e,t,n;e="https://api.instagram.com/v1";switch(this.options.get){case"popular":t="media/popular";break;case"tagged":if(typeof this.options.tagName!="string")throw new Error("No tag name specified. Use the 'tagName' option.");t="tags/"+this.options.tagName+"/media/recent";break;case"location":if(typeof this.options.locationId!="number")throw new Error("No location specified. Use the 'locationId' option.");t="locations/"+this.options.locationId+"/media/recent";break;case"user":if(typeof this.options.userId!="number")throw new Error("No user specified. Use the 'userId' option.");if(typeof this.options.accessToken!="string")throw new Error("No access token. Use the 'accessToken' option.");t="users/"+this.options.userId+"/media/recent";break;default:throw new Error("Invalid option for get: '"+this.options.get+"'.")}return n=""+e+"/"+t,this.options.accessToken!=null?n+="?access_token="+this.options.accessToken:n+="?client_id="+this.options.clientId,n+="&count="+this.options.limit,n+="&callback=instafeedCache"+this.unique+".parse",n},e.prototype._genKey=function(){var e;return e=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},""+e()+e()+e()+e()},e}(),t=typeof exports!="undefined"&&exports!==null?exports:window,t.Instafeed=e}).call(this);